<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Megatron-One</title>

    <!-- Bootstrap -->
    <link href="{{ url_for('static', filename='css/bootstrap.min.css') }}" rel="stylesheet" type="text/css">
    <link href="{{ url_for('static', filename='styles.css') }}" rel="stylesheet" type="text/css">
    <link href="{{ url_for('static', filename='css/dropdown-enhancement.css') }}" rel="stylesheet" type="text/css">
    <link href="{{ url_for('static', filename='bootstrap-vertical-tabs/bootstrap.vertical-tabs.css') }}" rel="stylesheet" type="text/css">
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/jquery.bootstrapvalidator/0.5.0/css/bootstrapValidator.min.css"/>
    <link rel="stylesheet" href="//cdn.datatables.net/1.10.2/css/jquery.dataTables.min.css"/>
    <link rel="stylesheet" href="//datatables.net/download/build/dataTables.fixedHeader.nightly.css?_=89fcfc0e0d5de89565e85821f69e2a4f"/>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="http://code.jquery.com/jquery-latest.js" type="text/javascript"></script>
    <script src="{{ url_for('static', filename='js/bootstrap.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/dropdown-enhancement.js') }}"></script>

   <script src="{{ url_for('static', filename='jQuery.mmenu-master/src/js/jquery.mmenu.min.all.js') }}" type="text/javascript"></script>
   <link href="{{ url_for('static', filename='jQuery.mmenu-master/src/css/jquery.mmenu.all.css') }}" type="text/css" rel="stylesheet" />
   <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery.bootstrapvalidator/0.5.0/js/bootstrapValidator.min.js"></script>
   <script type="text/javascript" src="//cdn.datatables.net/1.10.2/js/jquery.dataTables.min.js"></script>
   <script type="text/javascript" src="//datatables.net/download/build/dataTables.fixedHeader.nightly.js?_=f3fee85fd628f5086971c3243dfdf715"></script>


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
 <body>

<div class="container">
<div class="allcontents">
<div class="row margintop20">
    <div class="col-md-2"></div>
    <div class="col-md-8">{% if warning == '' %} <div class="alert alert-warning text-center margintop20">You don't have your settings set up!!!</div> {% endif %}</div>
    <div class="col-md-2"></div></div>
<div class="row">
<div class="col-md-2"></div>
<div class="col-md-8 form-inline bg-success border-radius" id="outer">

        <form id="add_query" method="post" action="{{ url_for('main') }}">


            <div class="btn-group">
              <button data-toggle="dropdown" class="btn dropdown-toggle btn-primary"  data-placeholder="false">{{ Location }} <span class="caret"></span></button>
                <ul id="nigga" class="dropdown-menu">

                    <li class="dropdown-submenu"><a href="#" tabindex="-1" data-toggle="dropdown">CV Bankas: <span data-label-placement="">all</span></a>
                        <ul class="dropdown-menu">
                   {% for city in cities_cvb %}
                  <li><input tabindex="-1" type="checkbox" id="{{ city }}" name='{{ city }}'><label for="{{ city }}">{{ city }}</label></li>
                   {% endfor %}
                        </ul>
                  </li>

                  <li class="dropdown-submenu"><a href="#" tabindex="-1" data-toggle="dropdown">CV Online: <span data-label-placement="">all</span></a>
                        <ul class="dropdown-menu">
                   {% for city in cities_cvo %}
                  <li><input tabindex="-1" type="checkbox" id="{{ city[1] }}" name='{{ city[1] }}'><label for="{{ city[1] }}">{{ city[0] }}</label></li>
                   {% endfor %}
                        </ul>
                  </li>

                        <!-- Other items -->
                </ul>
            </div>



            <div class="btn-group">
              <button data-toggle="dropdown" class="btn dropdown-toggle btn-primary"  data-placeholder="false">{{ Industry }} <span class="caret"></span></button>
                <ul id="nigga2" class="dropdown-menu">

                  <li class="dropdown-submenu"><a href="#" tabindex="-1" data-toggle="dropdown">CV Bankas: <span data-label-placement="">all</span></a>
                        <ul class="dropdown-menu">
                   {% for industry in industries_cvb %}
                  <li><input tabindex="-1" type="checkbox" id="{{ industry }}" name='{{ industry }}'><label for="{{ industry }}">{{ industry }}</label></li>
                   {% endfor %}
                        </ul>
                  </li>

                  <li class="dropdown-submenu"><a href="#" tabindex="-1" data-toggle="dropdown">CV Online: <span data-label-placement="">all</span></a>
                        <ul class="dropdown-menu">
                   {% for industry in industries_cvo %}
                  <li><input tabindex="-1" type="checkbox" id="{{ industry[1] }}" name='{{ industry[1] }}'><label for="{{ industry[1] }}">{{ industry[0] }}</label></li>
                   {% endfor %}
                        </ul>
                  </li>

                        <!-- Other items -->
                </ul>
            </div>


            <div class="btn-group">
              <button data-toggle="dropdown" class="btn dropdown-toggle btn-primary"  data-placeholder="false">{{ Database }} <span class="caret"></span></button>
                <ul class="dropdown-menu">
                  <li><input type="checkbox" id="c1" name="CVO"><label for="c1">CVOnline</label></li>
                  <li><input type="checkbox" id="c2" name="CVB"><label for="c2">CVBankas</label></li>

                </ul>
            </div>



            <div class="btn-group display-none">
              <button data-toggle="dropdown" class="btn dropdown-toggle btn-primary"  data-placeholder="false">{{ More_options }} <span class="caret"></span></button>
                <ul class="dropdown-menu">

                  <li class="dropdown-submenu"><a href="#" tabindex="-1" data-toggle="dropdown">Nothing</a>
                        <ul class="dropdown-menu">


                  <li class="dropdown-submenu"><a href="#" tabindex="-1" data-toggle="dropdown">CV Bankas: <span data-label-placement="">all</span></a>
                        <ul class="dropdown-menu">
                   {% for exp in experience_cvb %}
                  <li><input tabindex="-1" type="checkbox" id="{{ exp[1] }}" name='{{ exp[1] }}'><label for="{{ exp[1] }}">{{ exp[0] }}</label></li>
                   {% endfor %}
                        </ul>
                  </li>

                  <li class="dropdown-submenu"><a href="#" tabindex="-1" data-toggle="dropdown">CV Online: <span data-label-placement="">all</span></a>
                        <ul class="dropdown-menu">
                   {% for exp in experience_cvo %}
                  <li><input tabindex="-1" type="checkbox" id="{{ exp[1] }}" name='{{ exp[1] }}'><label for="{{ exp[1] }}">{{ exp[0] }}</label></li>
                   {% endfor %}
                        </ul>
                  </li>

                        </ul>
                  </li>

                </ul>
            </div>





            <div class="input-group">
                <input type=text class="form-control kwrds" placeholder={{ Keywords }} name=kwrds required>
            </div>


            <div class="input-group">
                <input type="number" class="form-control" placeholder={{ cvold }} name="CVold" id="cvold">
            </div>


            <button class="btn btn-primary" type={{ type }} id={{ id }} data-action="search"><span class="glyphicon glyphicon-zoom-in"></span> <span id="text-search">{{ Search }}</span> </button>


        </form>

</div>
<div class="col-md-1"></div>
</div>

<div class="row">
    <div class="col-md-2"></div>
<div class="col-md-8 bg-success border-radius" id="wrap" hidden="hidden">{{ results | safe }}</div>
    <div class="col-md-1 cv-tabs" hidden="hidden">
  <!-- Nav tabs -->
  <ul id="result-tab" class="nav nav-tabs tabs-right sideways">
    <li class="active"><a href="#cvb-r" data-toggle="tab">CV Bankas</a></li>
    <li><a id="cvo-r" href="#cvo-r" data-toggle="tab">CV Online</a></li>
  </ul>
</div>
</div>

</div>
</div>


<div id="floatingCirclesG">
    <div class="f_circleG" id="frotateG_01">
    </div>
    <div class="f_circleG" id="frotateG_02">
    </div>
    <div class="f_circleG" id="frotateG_03">
    </div>
    <div class="f_circleG" id="frotateG_04">
    </div>
    <div class="f_circleG" id="frotateG_05">
    </div>
    <div class="f_circleG" id="frotateG_06">
    </div>
    <div class="f_circleG" id="frotateG_07">
    </div>
    <div class="f_circleG" id="frotateG_08">
    </div>
</div>




<nav id="my-menu">
   <ul>
      <li>
         <a href="#"><i class="fa fa-bars"></i> Queries</a>
         <ul id="qries">
            {{ queries | safe }}
         </ul>
      </li>
      <li><a id="nav-search" href='?search=on'><i class="fa fa-globe"></i> Search</a></li>
      <li><a id="nav-newquery" href='/'><i class="fa fa-plus-square"></i> New Query</a></li>
      <li><a id="nav-following" href='/'><i class="fa fa-eye"></i> Followed CVs</a></li>
      <li><a id="nav-settings" href=''><i class="fa fa-gear"></i> Settings</a></li>
      <li><a href={{ url_for('logout') }}><i class="fa fa-user"></i> Logout ({{ user }})</a></li>
   </ul>
</nav>



<a id="hamburger" class="mm-fixed-top" href="#"><span></span></a>


<div id="modal"></div>

<div class="form-inline">
    <div id="city-show" class="form-group"></div>
    <div id="industry-show" class="form-group"></div>
    <div  class="form-group"></div>
</div>



<script>

   $(document).ready(function() {
       $('ul#nigga').on('click','input[type="checkbox"]', function(){
           var $this = $(this);
           var div = $('#city-show');
           var name = $this.attr('name');
           if ($this.prop('checked')){
               console.log(div.text());
               var lol = "<span"+" id="+name+ ">" + name +"</span>";
               div.append(lol)
           }
           else {
            $("span[id*='$in']".replace('$in', name)).remove()
           }
       })
   });   $(document).ready(function() {
       $('ul#nigga2').on('click','input[type="checkbox"]', function(){
           var $this = $(this);
           var div = $('#industry-show');
           var name = $this.attr('name');
           if ($this.prop('checked')){
               console.log(div.text());
               var lol = "<span"+" id="+name+ ">" + name +"</span>";
               div.append(lol)
           }
           else {
            $("span[id*='$in']".replace('$in', name)).remove()
           }
       })
   });

    {{ noice_js | safe }}

$(document).ready(function () {
    var top = $('#hamburger').offset().top - parseFloat($('#hamburger').css('marginTop').replace(/auto/, 0));
    $(window).scroll(function (event) {
        var y = $(this).scrollTop();
        //if y > top, it means that if we scroll down any more, parts of our element will be outside the viewport
        //so we move the element down so that it remains in view.
        if (y >= top) {
           var difference = y - top;
           $('#sidebar').css("top",difference);
       }
   });
});

//  CV viewed functions //
(function(){

    $('.allcontents').on('click','input.cvread', function(){
        var $this = $(this);
        var input = $this.attr('name');
        var dataid = $this.attr('data-id');

        if ($('td.'+input).hasClass('cvcheck')) {
            $('td.'+input).removeClass('cvcheck');
            viewed('False', dataid)
        }
        else {
            viewed('True', dataid);
           $('td.'+input).addClass('cvcheck');
        }

        function viewed(is, id){
            $.ajax({
            type:"POST",
            encoding:"UTF-8",
            url: "{{ url_for('update') }}",
            data: JSON.stringify({'url':$('td.'+input).text(), 'viewed': is, 'id':id}),
            contentType: 'application/json;charset=UTF-8',
            success: function(result) {
    }
        });
        }
    });

})();

(function(){
    $('.allcontents').on('mousedown','a.cvurl', function(){
        var $this = $(this);
        var input = $this.parent().attr('data-box');
        var dataid = $this.parent().attr('data-id');
        $this.mouseup(function(){
            if (!$this.parent().hasClass('cvcheck')) {
                $this.parent().addClass('cvcheck');
                $("input.cvread."+input).prop('checked', true);
                viewed('True', $this.text(), dataid)
            }
            else {
                viewed('True', $this.text(), dataid)
            }
        })
    });


        function viewed(is, input, id){
         $.ajax({
         type:"POST",
         encoding:"UTF-8",
         url: "{{ url_for('update') }}",
         data: JSON.stringify({'url':input, 'viewed': is, 'id':id}),
         contentType: 'application/json;charset=UTF-8',
         success: function(result) {
    }
        });
        }


})();
//  CV viewed functions //

//  CV follow functions //
(function(){

    $('.allcontents').on('click','input.cvfollow', function(){
        var $this = $(this);
        var dataid = $this.attr('data-id');

        if ($this.hasClass('following')) {
            follow('False', dataid);
            $this.removeClass('following');
        }
        else {
            $this.addClass('following');
            follow('True', dataid);
        }

        function follow(is, id){
            $.ajax({
            type:"POST",
            encoding:"UTF-8",
            url: "{{ url_for('update') }}",
            data: JSON.stringify({'follow': is, 'id':id}),
            contentType: 'application/json;charset=UTF-8',
            success: function(result) {
    }
        });
        }
    });

})();
//  CV follow functions //

 (function(){

    $('.allcontents').on('submit', 'form[id="add_query"]', function(e){
        e.preventDefault();
        var loader = $('#floatingCirclesG');
        loader.show();

        var data = $(this).serialize();
        var $wrap = $('#wrap');
        var $tabs = $('.cv-tabs');


        // see which button to display for tabs
        var db = '';
        if (data.indexOf('CVB=on') > -1 && data.indexOf('CVO=on') == -1){
            db = 'CVB'
        }
        else if (data.indexOf('CVB=on') == -1 && data.indexOf('CVO=on') > -1){
            db = 'CVO'
        }
        if (db == ''){}
        else if (db == 'CVO') {
             $tabs.children().children().first().remove();
             $tabs.children().children().last().addClass('active')
        }
        else if (db == "CVB") {
             $tabs.children().children().last().remove()
        }

        $('button[data-toggle="dropdown"]').attr('disabled', 'disabled');
        $(".form-control").attr('disabled', 'disabled');

        $.ajax({
            type:"POST",
            encoding:"UTF-8",
            url: "{{ url_for('result') }}",
            data: JSON.stringify(data),
            contentType: 'application/json;charset=UTF-8',
            success: function(result) {
                loader.hide();
                $('#text-search').text('Update');
                $('#search').removeAttr('type')
                                    .attr('type', 'button')
                                    .attr('id', 'update');

                $('#qries').empty()
                           .append(result.queries);
                $wrap.append(result.data);
                $wrap.fadeIn();
                $tabs.fadeIn();


                 table = $('.table').DataTable({
                    paging:         false,
                    searching: false,
                    scrollY: 450
                });



    $('a[data-toggle="tab"]').on('shown.bs.tab', function() {
        table.columns.adjust()
    })
    }
        });
    })

 })();

(function(){

    $('.allcontents').on('submit', 'form[id="search"]', function(e){
        e.preventDefault();
        console.log('dis search');
        var loader = $('#floatingCirclesG');
        var data = $(this).serialize();
        var $wrap = $('#wrap');
        var $tabs = $('.cv-tabs');
        // see which button to display for tabs
        var db = '';
        if (data.indexOf('CVB=on') > -1 && data.indexOf('CVO=on') == -1){
            db = 'CVB'
        }
        else if (data.indexOf('CVB=on') == -1 && data.indexOf('CVO=on') > -1){
            db = 'CVO'
        }
        if (db == ''){}
        else if (db == 'CVO') {
             $tabs.children().children().first().hide();
             $tabs.children().children().last().addClass('active')
        }
        else if (db == "CVB") {
             $tabs.children().children().last().hide()
        }
        $wrap.empty()
              .hide();
        loader.show();
        console.log(db);
        $.ajax({
            type:"POST",
            encoding:"UTF-8",
            url: "{{ url_for('search') }}",
            data: JSON.stringify(data),
            contentType: 'application/json;charset=UTF-8',
            success: function(result) {
                loader.hide();
                $('#text-search').text('New search');
                $wrap.append(result.data);
                $wrap.fadeIn();
                $tabs.fadeIn();
                table = $('.table').DataTable({
                    paging:         false,
                    searching: false,
                    scrollY: 450
                });

    $('a[data-toggle="tab"]').on('shown.bs.tab', function() {
        table.columns.adjust()
    })
    }
        });
    })

 })();

(function(){

    $('.allcontents').on('submit', 'form[id="update"]', function(e){
       e.preventDefault();
       var data = $(this).serialize();
       var id = $('.table').attr('data-query_id');
       var loader = $('#floatingCirclesG');
       var $allcontents = $('.allcontents');


        $allcontents.empty()
                    .hide();

        loader.show();

        $.ajax({
            type:"POST",
            encoding:"UTF-8",
            url: "{{ url_for('update') }}",
            data: JSON.stringify({'query_id': id, 'data': data}),
            contentType: 'application/json;charset=UTF-8',
            success: function(result) {
                loader.hide();
                $allcontents.append(result.data);
                $allcontents.fadeIn();
                $('.cv-tabs').fadeIn();
                table = $('.table').DataTable({
                    paging:         false,
                    searching: false,
                    scrollY: 450
                });


    $('a[data-toggle="tab"]').on('shown.bs.tab', function() {
        table.columns.adjust()
    })
    }
        });
    })

 })();





(function(){

    $('nav').on('click', 'a[id="nav-search"]', function(e){
        e.preventDefault();
        var loader = $('#floatingCirclesG');
        var maindiv = $('.allcontents');
        maindiv.empty()
               .hide();
        loader.show();

        $.ajax({
            type:"GET",
            encoding:"UTF-8",
            url: "{{ url_for('search') }}",
            contentType: 'application/json;charset=UTF-8',
            success: function(result) {

                loader.delay(1000).hide();
                maindiv.append(result.data)
                        .fadeIn("slow");

    }
        });
    })

 })();

(function(){

    $('nav').on('click', 'a[id="nav-following"]', function(e){
        e.preventDefault();
        var loader = $('#floatingCirclesG');
        var maindiv = $('.allcontents');
        maindiv.empty()
               .hide();
        loader.show();

        $.ajax({
            type:"GET",
            encoding:"UTF-8",
            url: "{{ url_for('follow') }}",
            contentType: 'application/json;charset=UTF-8',
            success: function(result) {

                loader.delay(1000).hide();
                maindiv.append(result.data)
                        .fadeIn("slow");
                table = $('.table').DataTable({
                    paging:         false,
                    searching: false,
                    scrollY: 450
                });


    }
        });
    })

 })();

(function(){

    $('nav').on('click', 'a[id="nav-settings"]', function(e){
        e.preventDefault();
        var loader = $('#floatingCirclesG');
        var maindiv = $('.allcontents');
        maindiv.empty()
               .hide();
        loader.show();

        $.ajax({
            type:"GET",
            encoding:"UTF-8",
            url: "{{ url_for('settings') }}",
            contentType: 'application/json;charset=UTF-8',
            success: function(result) {

                loader.delay(1000).hide();
                maindiv.append(result.data)
                        .fadeIn("slow");

    }
        });
    })

 })();

(function(){


    $('nav').on('click', 'a[class="existing_queries"]', function(e){
        e.preventDefault();
        var data = $(this).attr('id');
        var loader = $('#floatingCirclesG');
        var maindiv = $('.allcontents');
        maindiv.empty()
               .hide();
        loader.show();

        $.ajax({
            type:"POST",
            encoding:"UTF-8",
            data: JSON.stringify(data),
            url: "{{ url_for('display') }}",
            contentType: 'application/json;charset=UTF-8',
            success: function(result) {

                loader.delay(1000).hide();
                maindiv.fadeIn('slow')
                       .append(result.data);
                $('.cv-tabs').fadeIn();
                table = $('.table').DataTable({
                    paging: false,
                    searching: false,
                    scrollY: 450
                });




    $('a[data-toggle="tab"]').on('shown.bs.tab', function() {
        table.columns.adjust()
    })
    }

        });

    });

    $("#my-menu").mmenu({
        slidingSubmenus: false
    })
                .on('closed.mm', function(){
            table.columns.adjust();

    });
    $('#hamburger').on('click', function() {
          $('#my-menu').trigger('open.mm');

      });
    $('.allcontents').on( 'click', 'tr', function () {
        console.log('sup');
        if ( $(this).hasClass('selected') ) {
            $(this).removeClass('selected');
        }
        else {
            table.$('tr.selected').removeClass('selected');
            $(this).addClass('selected');
        }
    } );
 })();


(function(){

    $('.allcontents').on('click', 'button[data-md="true"]', function(e){
        e.preventDefault();
        var icon = $(this).children();
        icon.toggleClass('fa-save fa-cog fa-spin');
        var data = $(this).attr('data-id');

        $.ajax({
            type:"POST",
            encoding:"UTF-8",
            data: JSON.stringify({'get': data}),
            url: "{{ url_for('modal') }}",
            contentType: 'application/json;charset=UTF-8',
            success: function(result) {
                icon.toggleClass('fa-save fa-cog fa-spin');
                $('#modal').append(result.data);
                $('#damodal').modal();
    }
        });
    })

 })();


(function(){

    $('#modal').on('click', 'button#submitmodal', function(e){
        e.preventDefault();
        var $btn = $('button#submitmodal');
        $btn.button('loading');
        var cv_id = $(this).attr('data-id');
        var form_data = $('form#modalcontent').serialize();
        $.ajax({
            type:"POST",
            encoding:"UTF-8",
            data: JSON.stringify({'cv_id': cv_id, 'form_data': form_data}),
            url: "{{ url_for('modal') }}",
            contentType: 'application/json;charset=UTF-8',
            success: function(result) {
                $('#damodal').modal('toggle')
                              .on('hidden.bs.modal', function(){
                              $('#modal').empty()
                });
                console.log('after')
    }
        });


    })
            .on('click', 'button#exit', function(){
                $('#damodal').modal('toggle')
                              .on('hidden.bs.modal', function(){
                              $('#modal').empty()
                });
            })

 })();

(function(){
    $(document).on('click', '#queryremove', function(){
        var id = $(this).attr('data-id');
        $.ajax({
            type:"POST",
            encoding:"UTF-8",
            data: JSON.stringify({'display': id}),
            url: "{{ url_for('update') }}",
            contentType: 'application/json;charset=UTF-8',
            success: function(result) {
                $('.fa-ban').popover('destroy');
                $('a#'+id).hide();

    }
        });

    });
    $(document).on('click', '#close-popover', function(){
        $('.fa-ban').popover('hide')
    })
 })();
</script>



  </body>
</html>